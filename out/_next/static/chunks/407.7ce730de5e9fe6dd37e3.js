(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{407:function(e,r,n){"use strict";n.r(r),n.d(r,{RenderPromises:function(){return p},getDataFromTree:function(){return a},getMarkupFromTree:function(){return h},renderToStringWithData:function(){return l}});var t=n(5353),o=n(3914),i=n(4273),u=n(7822),s=n(2608);function c(){return new u.B(!1,(function(){return{seen:!1,observable:null}}))}var p=function(){function e(){this.queryPromises=new Map,this.queryInfoTrie=c(),this.stopped=!1}return e.prototype.stop=function(){this.stopped||(this.queryPromises.clear(),this.queryInfoTrie=c(),this.stopped=!0)},e.prototype.registerSSRObservable=function(e){this.stopped||(this.lookupQueryInfo(e.options).observable=e)},e.prototype.getSSRObservable=function(e){return this.lookupQueryInfo(e).observable},e.prototype.addQueryPromise=function(e,r){if(!this.stopped&&!this.lookupQueryInfo(e.getOptions()).seen)return this.queryPromises.set(e.getOptions(),new Promise((function(r){r(e.fetchData())}))),null;return r?r():null},e.prototype.addObservableQueryPromise=function(e){return this.addQueryPromise({getOptions:function(){return e.options},fetchData:function(){return new Promise((function(r){var n=e.subscribe({next:function(e){e.loading||(r(),n.unsubscribe())},error:function(){r(),n.unsubscribe()},complete:function(){r()}})}))}})},e.prototype.hasPromises=function(){return this.queryPromises.size>0},e.prototype.consumeAndAwaitPromises=function(){var e=this,r=[];return this.queryPromises.forEach((function(n,t){e.lookupQueryInfo(t).seen=!0,r.push(n)})),this.queryPromises.clear(),Promise.all(r)},e.prototype.lookupQueryInfo=function(e){return this.queryInfoTrie.lookup(e.query,(0,s.B)(e.variables))},e}(),f=n(7762);function a(e,r){return void 0===r&&(r={}),h({tree:e,context:r,renderFunction:f.renderToStaticMarkup})}function h(e){var r=e.tree,n=e.context,u=void 0===n?{}:n,s=e.renderFunction,c=void 0===s?f.renderToStaticMarkup:s,a=new p;return Promise.resolve().then((function e(){var n=(0,i.K)();return new Promise((function(e){var i=o.createElement(n.Provider,{value:(0,t.pi)((0,t.pi)({},u),{renderPromises:a})},r);e(c(i))})).then((function(r){return a.hasPromises()?a.consumeAndAwaitPromises().then(e):r})).finally((function(){a.stop()}))}))}function l(e){return h({tree:e,renderFunction:f.renderToString})}}}]);